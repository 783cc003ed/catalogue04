# NetSupport Intrusion Results in Domain Compromise

Авторы: 


Ссылка на контент: 
https://thedfirreport.com/2023/10/30/netsupport-intrusion-results-in-domain-compromise/

Краткое содержание: 

<blockquote>
During this report, we will analyze a case from January 2023 where a NetSupport RAT was utilized to infiltrate a network.   ...   <br>Once running, the threat actor then setup a scheduled task for persistence on these remote hosts.   ...   <br>No specific exfiltration was observed but we assess with medium confidence that this archive was exfiltrated over the network via one of the existing command and control channels.   ...   <br>While this was running, they used NetSupport to access a backup server to create a new account and add it to the local Administrators and Remote Desktop groups.   ...   <br>The threat actor checked on the status of Microsoft Defender and then proceeded to disable it.   ...   <br>After this, the threat actor then issued a PowerShell command to search and dump Windows event ID 4624 logon events from the host.   ...   <br>After this, no further hands on activity was seen from the threat actor before they were evicted from the network.   ...   <br>If you are interested in hearing more about our services or would like to talk about a free trial, please reach out using the Contact Us page.   ...   <br>The following is the deobfuscated NetSupport deployment script.   ...   <br># Write a Base64 Encoded String to Disk function Convert-StringToBinary (${InputString}, ${FilePath}) { ${file}= ${InputString}   ...   <br>The threat actor was observed making use of Batch scripts to automate some of their tasks, such as executing discovery programs, dumping credentials, and establishing persistence.   ...   <br>During the beginning stages of the intrusion, the NetSupport deployment script was used to establish persistence using the Run key under the user registry hive.   ...   <br>Since the deployment script was PowerShell based, the source process of the registry activity will appear as powershell.exe.   ...   <br>schtasks.exe /create /sc minute /mo 1 /tn "SSH Server" /rl highest /tr "C:\ProgramData\sshd\sshd.exe -f C:\ProgramData\sshd\config\sshd_config"   ...   <br>The threat actor created a local user account and added the user to the Administrators and Remote Desktop Users groups.   ...   <br>We can also see the command that was used to attempt to add the user to the administrators group.   ...   <br>We observed the threat actor dumping the ntds.dit database on two different domain controllers using a batch script, which then executed the command described in here:   ...   <br>It appears this will not work, as there is no directory for the find command, but the actor likely piped it together, as we saw execution of tasklist at the same time:   ...   <br>These were related to the discovery of information on users, hosts and the network configuration.   ...   <br>After the Impacket activity, the threat actor returned later to a domain controller and a backup server, where additional tooling was used for discovery.   ...   <br>On the domain controller, the threat actor executed the following commands:   ...   <br>On the backup server, the threat actor executed the following commands:   ...   <br>During the later stage of the intrusion, the threat actor dumped the event 4624 logs from a domain controller.   ...   <br>The file was not looked at on the host it was dumped on.   ...   <br>In between executions of atexec, we see Windows Security event logs that match behavior of lateral movement:   ...   <br>NetSupport connections were established on day one to 89.185.85.44 on port 2145; however, on day five of the intrusion, another NetSupport client32.ini file was deployed to other assets on the network, introducing a new command and control server of wsus-isv-local[.   ...   <br>]tech	NOERROR	79.137.206.37 wsus-isv-internal[.   ...   <br>On day five of this intrusion, two scheduled tasks (“SSH Server” and “SSH Key Exchange”) were created on the beachhead to establish a local SSH server running on port 2222 for remote system 185.206.146.129.   ...   
</blockquote>

Тэги: 


Дата публикования: 
2023-10-30T00:38:56+00:00

---

