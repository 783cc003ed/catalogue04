# Pwn2Own Toronto 2023: Part 3 – Exploration

Авторы: 
LUKASZ D

Ссылка на контент: 
https://blog.compass-security.com/2024/03/pwn2own-toronto-2023-part-3-exploration/

Краткое содержание: 

<blockquote>
A simple GET request was then sent to each of these paths.   ...   <br>Two sets of paths were found in this function.   ...   <br>By intercepting the traffic sent from the browser to the camera, we could see that Digest Auth is used and that a session cookie is received after a successful login.   ...   <br>This means that the path in the Authorization header does not have to match the path in the HTTP request, and the nonce set by the camera can be reused.   ...   <br>A few lines below is a piece of code that attempts to read a “Password” field from a JSON object, converts the read value to a string, and passes it as one of the arguments to the azdg_decrypt function.   ...   <br>Another interesting aspect about the JSON file containing the camera configuration is that the user we set for the camera is not the only user present in the JSON.   ...   <br>While investigating why the login with an empty password is denied, we noticed that in the same code we analyzed before, there is a check if the length of the decrypted password is 0, and if it is, the authentication flow is interrupted.   ...   <br>It turned out that one of us was running an automated scan of the camera’s web interface, and the file gets created by webd every time a request is sent to the path that does not require authentication, or when an authenticated request is sent.   ...   <br>In the systemd binary running on the camera, references to /tmp/backdoor and /data/app/backdoor were found and used to check for the existence of these files.   ...   <br>However, since we did not find any other functionality that could create either of these files, we did not investigate further what backdoor functionality was actually shipped with the camera.   ...   <br>Interestingly, despite the fact that the PUT request to set the language has a simple string in the body, the request must be sent with Content-Type: application/json, otherwise the request will not be accepted and an HTTP 404 response will be returned with an “Invalid Uri.” error message.   ...   <br>If the server is indeed expecting a JSON request, we sent a PUT request with a JSON body to the camera to see how such a request is processed.   ...   <br>However, to verify that the JSON data could be used instead of the path, authenticated requests must be sent, since only requests to the full /syno-api/security/info/language path can be unauthenticated.   ...   <br>If we were able to send a request to a path that does not require authentication, and provide such JSON in the body that the request would be interpreted as modifying some other configuration value, we would have an authentication bypass.   ...   <br>The observed behavior was consistent and did not depend on the path where the request was sent, but the authentication check was performed before parsing the JSON.   ...   
</blockquote>

Тэги: 
['pwn2own', 'research']

Дата публикования: 
2024-03-27T00:00:00

---

# Pwn2Own Toronto 2023: Part 5 – The Exploit

Авторы: 
URS MÜLLER

Ссылка на контент: 
https://blog.compass-security.com/2024/03/pwn2own-toronto-2023-part-5-the-exploit/

Краткое содержание: 

<blockquote>
In this final part of this series, we are finally going to explain how the stack-based buffer overflow vulnerability can be exploited to gain unauthenticated remote code execution (RCE) on the Synology BC500 camera.   ...   <br>To this end, we started looking for interesting data structures on the stack that we can overflow.   ...   <br>The first field in the struct stream_t is a function pointer.   ...   <br>As described in the comment on line 49, this function pointer is used to fetch the next character from the user input.   ...   <br>When overflowing the stack, the function pointer is the first field in the struct that is overflown.   ...   <br>The remainder of this section shows where and how the function pointer is invoked by libjansson.   ...   <br>This function (at address 0x0000581C) invokes sub_5418 (at address 0x00005418):   ...   <br>It was empirically determined that our attack is successful with an above 99% probability.   ...   <br>This section describes the two payloads that were used in the exploit (camera reboot and RCE payload).   ...   <br>Therefore, a camera reboot can be forced by sending 10 requests containing the payload above.   ...   <br>The payload contains two bash commands that will be executed when the payload is triggered, as well as the address of system_impl (in Unicode format):   ...   <br>Finally, on October 23rd it was time for two of our teammates to fly out to Toronto to demonstrate the exploit against the BC500 camera in the ZDI office.   ...   <br>The next day it was time to demonstrate the exploit.   ...   
</blockquote>

Тэги: 
['pwn2own', 'research']

Дата публикования: 
2024-03-29T00:00:00

---

# Pwn2Own Toronto 2023: Part 4 – Memory Corruption Analysis

Авторы: 
YVES BIERI

Ссылка на контент: 
https://blog.compass-security.com/2024/03/pwn2own-toronto-2023-part-4-memory-corruption-analysis/

Краткое содержание: 

<blockquote>
If you have not read the previous blog posts I recommend you to have a look at part 1, where we discuss how to extract the firmware from the camera, part 2 where we enumerate the attack surface, and part 3 where we discuss how we discovered the vulnerability.   ...   <br>For this we modify the last line of our script to start the CGI binary using gdbserver.   ...   <br>root@BC500_AD:/mnt/SD0$ cat gdb_cgi.sh export SERVER_NAME=IPCam   ...   <br>Using GDB, the decompiled pseudo-code, and the source code of libjansson from Github we started to analyze what functions are called when our request is handled to determine where our input causes memory corruption.   ...   <br>If a PUT request is sent, the handle_put_req [1] function will be called.   ...   <br>The PUT request handler of synocam_param.cgi will first extract the body from the HTTP request and then call  json_loads_wrapper [2] with the HTTP body as argument.   ...   <br>local_14 = __stack_chk_guard; req_body = get_body(*arg_req_info,"json"); local_bc = (int *)json_loads_wrapper(req_body); // [2] the HTTP body is passed to json_loads_wrapper local_ac = json_load_file("/www/camera-cgi/synocam_config.json",0,0); pcVar3 = getenv("SCRIPT_NAME");   ...   <br>In our case and object is processed, thus parse_object is called with the lex as argument [7].   ...   <br>int parse_object(struct *lex,uint flags,undefined4 error) { void *pvVar1; int iVar2; undefined4 uVar3; undefined overflow1 [32]; //  fixed size buffer char overflow2 [12];      // second fixed size buffer size_t n; int local_14; void *key; int local_c;   ...   <br>local_c = json_object(); if (local_c == 0) { local_c = 0; } else { lex_scan(lex,error); if (lex->string_val != L'}') { while (lex->string_val == 0x100) { key = (void *)lex_steal_string(lex,&n); if (key == (void *)0x0) { return 0; } pvVar1 = memchr(key,0,n); if (pvVar1 != (void *)0x0) { jsonp_free(key); error_set(error,lex,"NUL byte in object key not supported"); goto error_label; } overflow2[0] = '\0'; __isoc99_sscanf(key,"%s %s",overflow1,overflow2); // [8] user controlled key is read into the two stack buffers without bounds check if (((flags & 1) != 0) && (iVar2 = json_object_get(local_c,overflow1), iVar2 != 0)) { jsonp_free(key); error_set(error,lex,"duplicate object key"); goto error_label; } lex_scan(lex,error); if (lex->string_val != L':') { jsonp_free(key); error_set(error,lex,"\':\' expected"); goto error_label; } lex_scan(lex,error); local_14 = parse_value(lex,flags,error); if (local_14 == 0) { jsonp_free(key); goto error_label; } if (overflow2[0] == '\0') { *(undefined4 *)(local_14 + 8) = 0; } else { uVar3 = FUN_00016a04(overflow2); *(undefined4 *)(local_14 + 8) = uVar3; } iVar2 = json_object_set_nocheck(local_c,overflow1,local_14); if (iVar2 != 0) { jsonp_free(key); json_decref(local_14); goto error_label; } json_decref(local_14); jsonp_free(key); lex_scan(lex,error); if (lex->string_val != 0x2c) { if (lex->string_val == 0x7d) { return local_c; } error_set(error,lex,"\'}\' expected"); goto error_label; } lex_scan(lex,error); } error_set(error,lex,"string or \'}\' expected"); error_label: json_decref(local_c); local_c = 0; } } return local_c; }   ...   <br>A ROP chain uses small code snippets already present in the program to cause the program to do attacker defined behavior.   ...   <br>But between the sscanf call and the function’s return there is a quite some code with many checks we have to successfully pass.   ...   <br>If we overflow the buffer, we will overwrite the stack variable key in the process.   ...   <br>Thus, to not crash while taking this code path, key has to be a valid value for free.   ...   <br>To not crash the program, we have to overwrite key with a value that is a valid heap chunk or looks like one.   ...   <br>The address 0x76fcd39c [15] looks like a heap header of size 0x40 with the previous in use bit (0x1) set.   ...   <br>While debugging, we will set the key to 0x76fac530-4 before the call to jsonp_free to continue creating our proof of concept.   ...   <br>By omitting a colon in the JSON payload and with the correct fake chunk we can make the program skip most of the code and directly go to the error_label [12].   ...   <br>But if a_local_c + 4 points to a value that is -1 [16], we will skip all the checks and immediately return.   ...   <br>Additionally, JSON_ALLOW_NUL is not set, thus the payload cannot contain null bytes.   ...   <br>For this, we have to find gadgets that can be encoded as UTF-8 or UTF-8 surrogate pairs to create the ROP chain to execute arbitrary commands on the camera.   ...   
</blockquote>

Тэги: 
['pwn2own', 'research']

Дата публикования: 
2024-03-28T00:00:00

---

# Top things that you might not be doing (yet) in Entra Conditional Access – Advanced Edition

Авторы: 
Guillaume Bossiroy

Ссылка на контент: 
https://blog.nviso.eu/2024/03/18/top-things-that-you-might-not-be-doing-yet-in-entra-conditional-access-advanced-edition/

Краткое содержание: 

<blockquote>
In the first post of the top things that you might not be doing (yet) in Entra Conditional Access, we focused on basic but essential security controls that I recommend you checking out if you do not have them implemented already.   ...   <br>Additionally, should you need any introduction to what Entra Conditional Access is and which security controls are available, feel free to have a look at this post: https://blog.nviso.eu/2023/05/24/enforce-zero-trust-in-microsoft-365-part-3-introduction-to-conditional-access/.   ...   <br>Example: Conditional Access policy to block access to all cloud applications from Linux.   ...   <br>Secure Privileged Identity Management role activation with Conditional Access policies (see next point for more details); Include privileged Entra ID roles in Conditional Access, by selecting directory roles in the policy assignments; Integrate protected actions into Conditional Access policies to enforce step-up authentication when users perform specific privileged and high-impact actions (see next point for more details).   ...   <br>Authentication Context is a feature of Microsoft Entra Conditional Access and can therefore be managed from the Conditional Access service.   ...   <br>Once they have been created and published, we can use them in Conditional Access policies.   ...   <br>The custom PIM Authentication Context should be set as the target resource, and the conditions and access controls configured to meet your security requirements.   ...   <br>Integrate Entra ID Protected Actions with Conditional Access policies:   ...   <br>Link Protected Actions in Entra ID to Authentication Context.   ...   <br>Then, in a Conditional Access policy, set the target resource to the ‘Protection Actions’ Authentication Context and define the conditions as well as the access controls.   ...   <br>Last but not least, the ‘Filter for devices’-condition in Entra Conditional Access is a powerful tool that can be used for multiple purposes.   ...   <br>Example: Device filter condition in Entra Conditional Access policies.   ...   <br>This functionality has been introduced as a new condition in Microsoft Entra Conditional Access policies and allows to restrict device code flow and authentication transfer.   ...   <br>Firstly, the device code flow has been introduced to facilitate user sign-in on input-constrained devices, referred to as ‘device A.’ With this flow, users can authenticate on ‘device A’ by using a secondary device, referred to as ‘device B.’ They do this by visiting the URL: https://login.microsoftonline.com/common/oauth2/deviceauth.   ...   <br>Therefore, Conditional Access policies could now be used to block device code flow, or restrict it to managed devices only.   ...   <br>Example: Conditional Access policy to block the use of device code flow.   ...   <br>Like device code flow authentication, authentication transfer can be blocked using a Conditional Access policy.   ...   <br>For that purpose, the DCToolbox tool allows you to export the current configuration of your Conditional Access policies in an Excel file, for example.   ...   <br>Also, it is important to rigorously evaluate any policies before rolling them out in production and to make sure that other controls have also been properly configured in your cloud environment.   ...   <br>Conditional Access policies are a great way to safeguard your identities and critical resources, but are not the only layer of defense that you should be relying on.   ...   <br>Additionally, if you want to get a deeper understanding of some of the topics discussed in the blog post, all the resources that I have used can be found below:   ...   <br>Conditional Access: Block access: https://learn.microsoft.com/en-us/entra/identity/conditional-access/howto-conditional-access-policy-block-access Common Conditional Access policy: Require approved client apps or app protection policy: https://learn.microsoft.com/en-us/entra/identity/conditional-access/howto-policy-approved-app-or-app-protection App Protection Policies overview: https://learn.microsoft.com/en-us/mem/intune/apps/app-protection-policy App Protection Policy settings for Windows: https://learn.microsoft.com/en-us/mem/intune/apps/app-protection-policy-settings-windows Manage authentication methods for Microsoft Entra ID: https://learn.microsoft.com/en-us/entra/identity/authentication/concept-authentication-methods-manage What are protected actions in Microsoft Entra ID: https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/protected-actions-overview Add, test, or remove protected actions in Microsoft Entra ID: https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/protected-actions-add Conditional Access: Filter for devices: https://learn.microsoft.com/en-us/entra/identity/conditional-access/concept-condition-filters-for-devices About the author Guillaume Bossiroy   ...   
</blockquote>

Тэги: 
['azure ad', 'cloud', 'cloud security', 'conditional access', 'entra id', 'identities', 'microsoft', 'microsoft entra', 'tagged', 'zero trust']

Дата публикования: 
2024-03-18T09:00:00+01:00

---

# Unpacking Flutter hives

Авторы: 
Jeroen Beckers

Ссылка на контент: 
https://blog.nviso.eu/2024/03/13/unpacking-flutter-hives/

Краткое содержание: 

<blockquote>
Create a Flutter test app to get some useful Hives Understand the internals of the Hive framework Create a generic Hive reader that works on encrypted Hives containing custom objects Obtain the password of the encrypted Hive (Bonus) Recover deleted items   ...   <br>This is interesting, as the flutter_secure_storage plugin does use the system credential storage of the device to store data, so we can potentially intercept the key when it is being retrieved using Frida.   ...   <br>Let’s create a small Flutter application that uses Hive and saves some data into a box.   ...   <br>There is no global index of the frame offsets, which means that we can’t jump directly to a specific frame and we have to parse all the frames one by one until we have parsed all frames.   ...   <br>Each frame consists of a key (either a string or an index) and a value, which can be any default or custom type:   ...   <br>The type is 0x00 and the key is encoded as a uInt32.   ...   <br>The delete frame is simply a frame with a key and no value.   ...   <br>It’s not a far stretch to assume that the developer has used the automatically generated adapter, so let’s focus on that.   ...   <br>Luckily a List can contain any type of data in Dart, so we don’t have to worry about the actual types of the different fields.   ...   <br>class GenericAdapter extends TypeAdapter<List> { @override final int typeId;   ...   <br>We can then register this GenericAdapter for all the available custom typeIds (0 > 223) and read the beeBox we created earlier without needing the Bee or BeeAdapter class:   ...   <br>As explained earlier, the key is not encrypted, but the value is.   ...   <br>This means that we can use our GenericAdapter for encrypted boxes too, as long as we have the password.   ...   <br>It uses the Crc32 class which was copied from the source of the Hive framework so that we can be sure the logic is consistent:   ...   <br>cipher) async { var filePath = await copyFileToTemp(originalFile); var file = File(filePath); var bytes = await file.readAsBytes(); int offset = 0; var allFrames = BytesBuilder(); var keyNames = <String, int>{}; var keyInts = [];   ...   <br>// get bytes for TYPE + LENGTH + VALUE var bb = BytesBuilder(); bb.addByte(0x01); bb.addByte(modifiedKeyLength); bb.add(modifiedKeyBytes); newKey = bb.toBytes(); frameResize = modifiedKeyLength - keyLength; keyLength += 2; // add the length of the type } else{ // Key is int keyLength = 5; // type + uint32 var keyIndexOffset = keyOffset + 0x01; var keyInt = ByteData.sublistView(bytes, keyIndexOffset, keyIndexOffset + 4) .getUint32(0, Endian.little);   ...   <br>// Register the GenericAdapter for all available typeIds for(var i = 0; i<223; i++) { Hive.registerAdapter(GenericAdapter(i)); } // Decode password and open box var passwordBytes = base64.decode(password); var encryptionCipher = HiveAesCipher(passwordBytes); box = await Hive.openBox<dynamic>(boxName, path: directory, encryptionCipher: encryptionCipher); Dart   ...   
</blockquote>

Тэги: 
['flutter', 'mobile', 'reversing', 'tagged']

Дата публикования: 
2024-03-13T09:00:00+01:00

---

# Threat Brief: WordPress Plugin Exploit Leads to Godzilla Web Shell, Discovery & New CVE

Авторы: 


Ссылка на контент: 
https://thedfirreport.com/2024/03/04/threat-brief-wordpress-exploit-leads-to-godzilla-web-shell-discovery-new-cve/

Краткое содержание: 

<blockquote>
Below is a recent Threat Brief that we shared with our customers.   ...   <br>Recent Private Threat Briefs:   ...   <br>All Intel: Includes everything from Private Threat Briefs and Threat Feed, plus private events, long-term tracking, data clustering, and other curated intel.   ...   
</blockquote>

Тэги: 


Дата публикования: 
2024-03-04T01:22:08+00:00

---

# From Discovery to Disclosure: ReCrystallize Server Vulnerabilities

Авторы: 


Ссылка на контент: 
https://sensepost.com/blog/2024/from-discovery-to-disclosure-recrystallize-server-vulnerabilities/

Краткое содержание: 

<blockquote>
These vulnerabilities were disclosed to ReCrystallize Software and MITRE.   ...   <br>The third-party software was ‘ReCrystallize Server’ and was a standalone application.   ...   <br>The one direction was to read the documentation and find known vulnerabilities for this software, and the other direction was to hit the login and see what would happen.   ...   <br>Perhaps some juicy information is disclosed in there, so I decided to have a look.   ...   <br>In this example you are also able to see that the server is domain joined (no this is not a client domain as I made an effort to set up a lab environment).   ...   <br>This seemed like an important setting for me, but later in this post you will find out that it really is not.   ...   <br>While playing around with the application and crawling through the manual, I was able to download files from the server.   ...   <br>Although I was not able to upload a web shell, I was happy with it and ready to notify the client.   ...   <br>“You were only able to do that because we did not configure it.   ...   <br>Let’s try to access the admin functionality without and with the cookie being set.   ...   <br>Below is just an example of a way to download system files without authentication.   ...   <br>Recommendations There is a lot that can be said about this software.   ...   <br>As you’d see in the disclosure timeline, that did not go as well as one would hope for, and two years later there still is no formal patch these issues.   ...   <br>When a patch is available, the application itself should be hardened by making sure that absolute paths are not allowed, the default password is changed and encryption is turned on.   ...   <br>08-09-2022 – Disclosure of authentication bypass and unrestricted file upload vulnerabilities to ReCrystallize Software.   ...   <br>12-09-2022 – Vulnerabilities were accepted by ReCrystallize Software, expected patch in the next major release.   ...   <br>15-02-2024 – Requested a CVE from MITRE for the authentication bypass.   ...   
</blockquote>

Тэги: 
['cve-2024-26331', 'cve-2024-28269', 'exploit', 'vulnerability', 'web application', 'webapps']

Дата публикования: 
2024-03-22T00:00:00

---

